/var/spool/slurm/d/job180464/slurm_script: line 2: /homes/al4624/homes/al4624/Documents/YuE_finetune/YuE_finetune_trans_gen/finetune/run_finetune_log.txt: No such file or directory
===============================================
YuE Fine-tuning Configuration:
===============================================
Number of GPUs: 1
Global batch size: 1
Model: m-a-p/YuE-s1-7B-anneal-en-cot
Output directory: /vol/bitbucket/al4624/model_output
Training epochs: 10
===============================================
Running command: torchrun --nproc_per_node=1 --master_port=9999 scripts/train_lora.py     --seq-length 8192     --data-path 34708 ./example/mmap/trans_gen.msa.xcodec_16k_stage_1_token_level_interleave_cot_xcodec_textfirst_text_document 47114 ./example/mmap/trans_gen.msa.xcodec_16k_stage_1_token_level_interleave_long_prompt_msa_textfirst_dual_text_document 40945 ./example/mmap/trans_gen.msa.xcodec_16k_stage_1_token_level_interleave_long_prompt_msa_textfirst_inst_text_document 40945 ./example/mmap/trans_gen.msa.xcodec_16k_stage_1_token_level_interleave_long_prompt_msa_textfirst_mixture_text_document 40945 ./example/mmap/trans_gen.msa.xcodec_16k_stage_1_token_level_interleave_long_prompt_msa_textfirst_vocal_text_document     --data-cache-path /vol/bitbucket/al4624/data_cache     --split 900,50,50     --tokenizer-model ../inference/mm_tokenizer_v0.2_hf/tokenizer.model     --global-batch-size 1     --per-device-train-batch-size 1     --per-device-eval-batch-size 1     --train-iters 3     --num-train-epochs 10     --logging-steps 5     --save-steps 5     --deepspeed config/ds_config_zero2.json --report-to wandb --run-name "YuE-ft-lora"     --model-name-or-path "m-a-p/YuE-s1-7B-anneal-en-cot"     --cache-dir /vol/bitbucket/al4624/model_cache     --output-dir /vol/bitbucket/al4624/model_output     --lora-r 64     --lora-alpha 32     --lora-dropout 0.1     --lora-target-modules q_proj k_proj v_proj o_proj --bf16
===============================================
2025-07-07 18:49:38,576 - INFO - Running on a single GPU (device 0)
2025-07-07 18:49:38,616 - INFO - > Compiling dataset index builder...
make: Entering directory '/homes/al4624/Documents/YuE_finetune/YuE_finetune_trans_gen/finetune/core/datasets'
make: Nothing to be done for 'default'.
make: Leaving directory '/homes/al4624/Documents/YuE_finetune/YuE_finetune_trans_gen/finetune/core/datasets'
2025-07-07 18:49:38,658 - INFO - >>> Done with dataset index builder. Compilation time: 0.042 seconds
2025-07-07 18:49:38,660 - INFO - Loading tokenizer from m-a-p/YuE-s1-7B-anneal-en-cot
You are using the default legacy behaviour of the <class 'transformers.models.llama.tokenization_llama.LlamaTokenizer'>. This is expected, and simply means that the `legacy` (previous) behavior will be used so nothing changes for you. If you want to use the new behaviour, set `legacy=False`. This should only be set if you understand what it means, and thoroughly read the reason why this was added as explained in https://github.com/huggingface/transformers/pull/24565 - if you loaded a llama tokenizer from a GGUF file you can ignore this message
You are using the default legacy behaviour of the <class 'transformers.models.llama.tokenization_llama_fast.LlamaTokenizerFast'>. This is expected, and simply means that the `legacy` (previous) behavior will be used so nothing changes for you. If you want to use the new behaviour, set `legacy=False`. This should only be set if you understand what it means, and thoroughly read the reason why this was added as explained in https://github.com/huggingface/transformers/pull/24565 - if you loaded a llama tokenizer from a GGUF file you can ignore this message.
2025-07-07 18:49:39,825 - INFO - > Building train, validation, and test datasets...
2025-07-07 18:49:39,841 - INFO - Let split_vector = [0.9, 0.05, 0.05]
2025-07-07 18:49:39,841 - INFO - Load the _IndexReader from ./example/mmap/trans_gen.msa.xcodec_16k_stage_1_token_level_interleave_cot_xcodec_textfirst_text_document.idx
2025-07-07 18:49:39,842 - INFO - 	Extract the sequence lengths
2025-07-07 18:49:39,842 - INFO - 	Extract the sequence pointers
2025-07-07 18:49:39,842 - INFO - 	Extract the document indices
2025-07-07 18:49:39,842 - INFO - > total number of sequences: 20
2025-07-07 18:49:39,842 - INFO - > total number of documents: 4
2025-07-07 18:49:40,220 - INFO - Build and save the GPTDataset train indices
2025-07-07 18:49:40,225 - INFO - 	Build and save the document index to eed4db252b6766b6e3365a6d116e2edf-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,231 - INFO - 	Build and save the sample index to eed4db252b6766b6e3365a6d116e2edf-GPTDataset-sample_index.npy
2025-07-07 18:49:40,236 - INFO - 	Build and save the shuffle index to eed4db252b6766b6e3365a6d116e2edf-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,244 - INFO - > total number of samples: 3
2025-07-07 18:49:40,244 - INFO - > total number of epochs: 1
2025-07-07 18:49:40,245 - INFO - Build and save the GPTDataset valid indices
2025-07-07 18:49:40,248 - INFO - 	Build and save the document index to 1ad4b8f6475a669f1932ff960356a8f5-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,251 - INFO - 	Build and save the sample index to 1ad4b8f6475a669f1932ff960356a8f5-GPTDataset-sample_index.npy
2025-07-07 18:49:40,254 - INFO - 	Build and save the shuffle index to 1ad4b8f6475a669f1932ff960356a8f5-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,258 - INFO - > total number of samples: 18
2025-07-07 18:49:40,258 - INFO - > total number of epochs: 79
2025-07-07 18:49:40,259 - INFO - Build and save the GPTDataset test indices
2025-07-07 18:49:40,262 - INFO - 	Build and save the document index to c84114ef25bc35045f1b53799d6bd95d-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,265 - INFO - 	Build and save the sample index to c84114ef25bc35045f1b53799d6bd95d-GPTDataset-sample_index.npy
2025-07-07 18:49:40,269 - INFO - 	Build and save the shuffle index to c84114ef25bc35045f1b53799d6bd95d-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,272 - INFO - > total number of samples: 18
2025-07-07 18:49:40,272 - INFO - > total number of epochs: 43
2025-07-07 18:49:40,272 - INFO - Load the _IndexReader from ./example/mmap/trans_gen.msa.xcodec_16k_stage_1_token_level_interleave_long_prompt_msa_textfirst_dual_text_document.idx
2025-07-07 18:49:40,273 - INFO - 	Extract the sequence lengths
2025-07-07 18:49:40,273 - INFO - 	Extract the sequence pointers
2025-07-07 18:49:40,273 - INFO - 	Extract the document indices
2025-07-07 18:49:40,273 - INFO - > total number of sequences: 20
2025-07-07 18:49:40,273 - INFO - > total number of documents: 4
2025-07-07 18:49:40,275 - INFO - Build and save the GPTDataset train indices
2025-07-07 18:49:40,278 - INFO - 	Build and save the document index to cd9a1933ad3d106a3a9f7a48f7013b70-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,282 - INFO - 	Build and save the sample index to cd9a1933ad3d106a3a9f7a48f7013b70-GPTDataset-sample_index.npy
2025-07-07 18:49:40,285 - INFO - 	Build and save the shuffle index to cd9a1933ad3d106a3a9f7a48f7013b70-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,288 - INFO - > total number of samples: 5
2025-07-07 18:49:40,288 - INFO - > total number of epochs: 1
2025-07-07 18:49:40,290 - INFO - Build and save the GPTDataset valid indices
2025-07-07 18:49:40,293 - INFO - 	Build and save the document index to a49f24699d463d3dab1e2d3c5808e664-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,296 - INFO - 	Build and save the sample index to a49f24699d463d3dab1e2d3c5808e664-GPTDataset-sample_index.npy
2025-07-07 18:49:40,299 - INFO - 	Build and save the shuffle index to a49f24699d463d3dab1e2d3c5808e664-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,302 - INFO - > total number of samples: 24
2025-07-07 18:49:40,302 - INFO - > total number of epochs: 105
2025-07-07 18:49:40,304 - INFO - Build and save the GPTDataset test indices
2025-07-07 18:49:40,307 - INFO - 	Build and save the document index to 550a889d463e90428f95d7c8deb47921-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,310 - INFO - 	Build and save the sample index to 550a889d463e90428f95d7c8deb47921-GPTDataset-sample_index.npy
2025-07-07 18:49:40,313 - INFO - 	Build and save the shuffle index to 550a889d463e90428f95d7c8deb47921-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,316 - INFO - > total number of samples: 24
2025-07-07 18:49:40,316 - INFO - > total number of epochs: 58
2025-07-07 18:49:40,317 - INFO - Load the _IndexReader from ./example/mmap/trans_gen.msa.xcodec_16k_stage_1_token_level_interleave_long_prompt_msa_textfirst_inst_text_document.idx
2025-07-07 18:49:40,317 - INFO - 	Extract the sequence lengths
2025-07-07 18:49:40,317 - INFO - 	Extract the sequence pointers
2025-07-07 18:49:40,317 - INFO - 	Extract the document indices
2025-07-07 18:49:40,318 - INFO - > total number of sequences: 20
2025-07-07 18:49:40,318 - INFO - > total number of documents: 4
2025-07-07 18:49:40,319 - INFO - Build and save the GPTDataset train indices
2025-07-07 18:49:40,322 - INFO - 	Build and save the document index to 0cf21e0e90b16f43b88b97fc8304ada3-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,347 - INFO - 	Build and save the sample index to 0cf21e0e90b16f43b88b97fc8304ada3-GPTDataset-sample_index.npy
2025-07-07 18:49:40,351 - INFO - 	Build and save the shuffle index to 0cf21e0e90b16f43b88b97fc8304ada3-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,354 - INFO - > total number of samples: 4
2025-07-07 18:49:40,354 - INFO - > total number of epochs: 1
2025-07-07 18:49:40,355 - INFO - Build and save the GPTDataset valid indices
2025-07-07 18:49:40,358 - INFO - 	Build and save the document index to 629fc5cc66729aed64d99a7b342c4621-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,362 - INFO - 	Build and save the sample index to 629fc5cc66729aed64d99a7b342c4621-GPTDataset-sample_index.npy
2025-07-07 18:49:40,366 - INFO - 	Build and save the shuffle index to 629fc5cc66729aed64d99a7b342c4621-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,369 - INFO - > total number of samples: 21
2025-07-07 18:49:40,369 - INFO - > total number of epochs: 92
2025-07-07 18:49:40,370 - INFO - Build and save the GPTDataset test indices
2025-07-07 18:49:40,374 - INFO - 	Build and save the document index to b99b02b8d42066e61834d8cf6ab879c3-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,377 - INFO - 	Build and save the sample index to b99b02b8d42066e61834d8cf6ab879c3-GPTDataset-sample_index.npy
2025-07-07 18:49:40,380 - INFO - 	Build and save the shuffle index to b99b02b8d42066e61834d8cf6ab879c3-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,383 - INFO - > total number of samples: 21
2025-07-07 18:49:40,383 - INFO - > total number of epochs: 51
2025-07-07 18:49:40,384 - INFO - Load the _IndexReader from ./example/mmap/trans_gen.msa.xcodec_16k_stage_1_token_level_interleave_long_prompt_msa_textfirst_mixture_text_document.idx
2025-07-07 18:49:40,385 - INFO - 	Extract the sequence lengths
2025-07-07 18:49:40,385 - INFO - 	Extract the sequence pointers
2025-07-07 18:49:40,385 - INFO - 	Extract the document indices
2025-07-07 18:49:40,385 - INFO - > total number of sequences: 20
2025-07-07 18:49:40,385 - INFO - > total number of documents: 4
2025-07-07 18:49:40,386 - INFO - Build and save the GPTDataset train indices
2025-07-07 18:49:40,389 - INFO - 	Build and save the document index to 2b05ecc3f073359ff659aedc97aa1d38-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,392 - INFO - 	Build and save the sample index to 2b05ecc3f073359ff659aedc97aa1d38-GPTDataset-sample_index.npy
2025-07-07 18:49:40,396 - INFO - 	Build and save the shuffle index to 2b05ecc3f073359ff659aedc97aa1d38-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,399 - INFO - > total number of samples: 4
2025-07-07 18:49:40,399 - INFO - > total number of epochs: 1
2025-07-07 18:49:40,400 - INFO - Build and save the GPTDataset valid indices
2025-07-07 18:49:40,403 - INFO - 	Build and save the document index to 0a3f1fd036addef10446092f9a032d73-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,407 - INFO - 	Build and save the sample index to 0a3f1fd036addef10446092f9a032d73-GPTDataset-sample_index.npy
2025-07-07 18:49:40,410 - INFO - 	Build and save the shuffle index to 0a3f1fd036addef10446092f9a032d73-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,413 - INFO - > total number of samples: 21
2025-07-07 18:49:40,413 - INFO - > total number of epochs: 92
2025-07-07 18:49:40,415 - INFO - Build and save the GPTDataset test indices
2025-07-07 18:49:40,418 - INFO - 	Build and save the document index to c8fa58345a25edc4e0827994d0d9546b-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,421 - INFO - 	Build and save the sample index to c8fa58345a25edc4e0827994d0d9546b-GPTDataset-sample_index.npy
2025-07-07 18:49:40,425 - INFO - 	Build and save the shuffle index to c8fa58345a25edc4e0827994d0d9546b-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,428 - INFO - > total number of samples: 21
2025-07-07 18:49:40,428 - INFO - > total number of epochs: 51
2025-07-07 18:49:40,428 - INFO - Load the _IndexReader from ./example/mmap/trans_gen.msa.xcodec_16k_stage_1_token_level_interleave_long_prompt_msa_textfirst_vocal_text_document.idx
2025-07-07 18:49:40,429 - INFO - 	Extract the sequence lengths
2025-07-07 18:49:40,429 - INFO - 	Extract the sequence pointers
2025-07-07 18:49:40,429 - INFO - 	Extract the document indices
2025-07-07 18:49:40,429 - INFO - > total number of sequences: 20
2025-07-07 18:49:40,429 - INFO - > total number of documents: 4
2025-07-07 18:49:40,431 - INFO - Build and save the GPTDataset train indices
2025-07-07 18:49:40,434 - INFO - 	Build and save the document index to bb4a1f7fc2814648929ff980981f47e2-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,438 - INFO - 	Build and save the sample index to bb4a1f7fc2814648929ff980981f47e2-GPTDataset-sample_index.npy
2025-07-07 18:49:40,441 - INFO - 	Build and save the shuffle index to bb4a1f7fc2814648929ff980981f47e2-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,445 - INFO - > total number of samples: 4
2025-07-07 18:49:40,445 - INFO - > total number of epochs: 1
2025-07-07 18:49:40,447 - INFO - Build and save the GPTDataset valid indices
2025-07-07 18:49:40,450 - INFO - 	Build and save the document index to 7e0d5e978bb7aadfb0acc106c9385514-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,453 - INFO - 	Build and save the sample index to 7e0d5e978bb7aadfb0acc106c9385514-GPTDataset-sample_index.npy
2025-07-07 18:49:40,456 - INFO - 	Build and save the shuffle index to 7e0d5e978bb7aadfb0acc106c9385514-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,460 - INFO - > total number of samples: 21
2025-07-07 18:49:40,460 - INFO - > total number of epochs: 92
2025-07-07 18:49:40,461 - INFO - Build and save the GPTDataset test indices
2025-07-07 18:49:40,464 - INFO - 	Build and save the document index to 06d5f8c751e6688a574519b84ba15f81-GPTDataset-document_index.npy
INFO: document_index shuffle is disabled...
2025-07-07 18:49:40,468 - INFO - 	Build and save the sample index to 06d5f8c751e6688a574519b84ba15f81-GPTDataset-sample_index.npy
2025-07-07 18:49:40,471 - INFO - 	Build and save the shuffle index to 06d5f8c751e6688a574519b84ba15f81-GPTDataset-shuffle_index.npy
INFO: shuffle_index shuffle is enabled...
2025-07-07 18:49:40,474 - INFO - > total number of samples: 21
2025-07-07 18:49:40,474 - INFO - > total number of epochs: 51
2025-07-07 18:49:40,475 - INFO - Build and save the BlendedDataset indices
2025-07-07 18:49:40,475 - INFO - 	Build and save the dataset and dataset sample indexes
2025-07-07 18:49:41,471 - INFO - > BlendedDataset length: 5
2025-07-07 18:49:41,494 - INFO - Build and save the BlendedDataset indices
2025-07-07 18:49:41,494 - INFO - 	Build and save the dataset and dataset sample indexes
2025-07-07 18:49:41,676 - INFO - > BlendedDataset length: 105
2025-07-07 18:49:41,700 - INFO - Build and save the BlendedDataset indices
2025-07-07 18:49:41,700 - INFO - 	Build and save the dataset and dataset sample indexes
2025-07-07 18:49:41,882 - INFO - > BlendedDataset length: 105
2025-07-07 18:49:41,904 - INFO - > Finished creating datasets
2025-07-07 18:49:41,904 - INFO - Loading base model from m-a-p/YuE-s1-7B-anneal-en-cot
Fetching 3 files:   0%|          | 0/3 [00:00<?, ?it/s]